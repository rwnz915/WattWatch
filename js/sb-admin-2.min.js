/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2021 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

(function($){
  "use strict";

  $(function(){ // DOM ready
    var STORAGE_KEY = 'smartwatt-sidebar-collapsed';
    var $body = $('body');
    var $sidebar = $('.sidebar'); // matches SB Admin .sidebar
    var $toggleBtns = $('#sidebarToggle, #sidebarToggleTop');

    // --- Apply saved state on load ---
    try {
      var saved = localStorage.getItem(STORAGE_KEY);
      if (saved === '1' || saved === 'true') {
        $body.addClass('sidebar-toggled');
        $sidebar.addClass('toggled');
        $sidebar.find('.collapse').collapse('hide');
      } else {
        $body.removeClass('sidebar-toggled');
        $sidebar.removeClass('toggled');
      }
    } catch (err) {
      console.warn('Sidebar state read failed', err);
    }

    // --- Bind toggle click (namespaced so we can safely .off() if needed) ---
    $toggleBtns.off('click.smartwatt').on('click.smartwatt', function(e){
      e.preventDefault(); // keep behavior consistent
      $body.toggleClass('sidebar-toggled');
      $sidebar.toggleClass('toggled');

      // hide any open accordion when toggled collapsed
      if ($sidebar.hasClass('toggled')) {
        $sidebar.find('.collapse').collapse('hide');
      }

      // save state
      try {
        var isCollapsed = $body.hasClass('sidebar-toggled') ? '1' : '0';
        localStorage.setItem(STORAGE_KEY, isCollapsed);
      } catch (err) {
        console.warn('Sidebar state save failed', err);
      }
    });

    // --- Keep behavior on resize (same idea as SB Admin) ---
    $(window).off('resize.smartwatt').on('resize.smartwatt', function(){
      if ($(window).width() < 768) {
        $sidebar.find('.collapse').collapse('hide');
      }
      if ($(window).width() < 480 && !$sidebar.hasClass('toggled')) {
        $body.addClass('sidebar-toggled');
        $sidebar.addClass('toggled');
        $sidebar.find('.collapse').collapse('hide');
        try { localStorage.setItem(STORAGE_KEY, '1'); } catch(e){ }
      }
    });

  }); // end DOM ready
})(jQuery);
