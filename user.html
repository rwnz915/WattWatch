<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <link rel="icon" href="img/logo.png" type="image/png">
    <title>WattWatch</title>

    <script>
        (function () {
            const savedTheme = localStorage.getItem("theme") || "System Default";
            const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

            if (savedTheme === "Dark" || (savedTheme === "System Default" && prefersDark)) {
                document.documentElement.classList.add("dark-mode");
            } else {
                document.documentElement.classList.remove("dark-mode");
            }
        })();
    </script>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center">
                <img src="img/logo.png" width="60px" height="50px">
                <div class="sidebar-brand-text mr-3">WattWatch</div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item">
                <a class="nav-link load-page" href="#" data-page="pages/dashboard.html">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Features
            </div>

            <!-- Nav Item - Calculator -->
            <li class="nav-item">
                <a class="nav-link load-page" href="#" data-page="pages/calculator.html">
                    <i class="fas fa-fw fa-calculator"></i>
                    <span>Calculator</span></a>
            </li>

            <!-- Nav Item - Goals -->
            <li class="nav-item">
                <a class="nav-link load-page" href="#" data-page="pages/goals.html">
                    <i class="fas fa-fw fa-bullseye"></i>
                    <span>Energy Goals</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                General
            </div>

            <!-- Nav Item - About -->
            <li class="nav-item">
                <a class="nav-link load-page" href="#" data-page="pages/history.html">
                    <i class="fas fa-history"></i>
                    <span>History</span></a>
            </li>

            <!-- Nav Item - Settings -->
            <li class="nav-item">
                <a class="nav-link load-page" href="#" data-page="pages/settings.html">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>Settings</span></a>
            </li>

            <!-- Nav Item - About -->
            <li class="nav-item">
                <a class="nav-link load-page" href="#" data-page="pages/about.html">
                    <i class="fas fa-fw fa-file-alt"></i>
                    <span>About</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

            <!-- Sidebar Message -->
            <!-- <div class="sidebar-card d-none d-lg-flex">
                <img class="sidebar-card-illustration mb-2" src="img/undraw_rocket.svg" alt="...">
                <p class="text-center mb-2"><strong>SB Admin Pro</strong> is packed with premium features, components, and more!</p>
                <a class="btn btn-success btn-sm" href="https://startbootstrap.com/theme/sb-admin-pro">Upgrade to Pro!</a>
            </div> -->

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Search -->
                    <!-- <form
                        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..."
                                aria-label="Search" aria-describedby="basic-addon2">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>-->

                    <!-- Energy Tip Display -->
                    <div id="energyTipBox" class="ml-3 my-auto px-3 py-2 rounded shadow-sm border-left-primary border bg-light">
                        <span id="energyTipText" class="text-dark font-weight-semibold small">
                            ðŸ’¡ "Turn off lights when not in use."
                        </span>
                    </div>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <!-- <li class="nav-item dropdown no-arrow d-sm-none">
                            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-search fa-fw"></i>
                            </a>
                            
                        </li> -->

                        <!-- Nav Item - Alerts -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-bell fa-fw"></i>
                                <span id="alertsCounter" class="badge badge-danger badge-counter" style="display:none;">0</span>
                            </a>
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="alertsDropdown">
                                <h6 class="dropdown-header">
                                     Alerts Center
                                </h6>

                                <!-- Dynamic alerts container -->
                                <div id="alertsDynamic">
                                    <div class="dropdown-item text-center small text-gray-500">No recent notifications</div>
                                </div>

                                <a class="dropdown-item text-center small text-gray-500 load-page" href="#" data-page="pages/activity_log.html">Show All Alerts</a>
                            </div>
                        </li>

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span id="userName" class="mr-2 d-none d-lg-inline text-gray-600 small">UserName</span>
                                <img class="img-profile rounded-circle"
                                    src="img/undraw_profile.svg">
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item load-page" href="#" data-page="pages/profile.html">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <!-- <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Settings
                                </a> -->
                                <a class="dropdown-item load-page" href="#" data-page="pages/activity_log.html">
                                    <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Alerts Center
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div id="main-content">
                    <!-- Content will be loaded here -->
                </div>

                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright Â© 2025 WattWatch. All rights reserved.</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <button id="logoutBtn" class="btn btn-primary">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- message / confirm modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content border-0">
                <div class="modal-body text-dark" id="messageText">Something went wrong.</div>
                <div class="modal-footer border-0">
                    <button id="cancelBtn" class="btn btn-secondary" data-dismiss="modal" style="display: none;">Cancel</button>
                    <button id="okBtn" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- loader -->
    <script src="js/message.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/userHelper.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/appState.js"></script>

    <script>
        let userName = document.getElementById("userName");

        let userInfo = getUserInfo();
        if (!userInfo) {
            window.location.href = "index.html";
        } else {
            userName.innerHTML = userInfo.firstName;
        }

        const topbarImg = document.querySelector(".img-profile.rounded-circle");
        if (topbarImg) topbarImg.src = userInfo.profileImage;

        document.getElementById("logoutBtn").addEventListener("click", () => {
            clearUserInfo(); // clear localStorage + sessionStorage
            window.location.href = "index.html"; // redirect to login
            localStorage.removeItem("theme");
        });
    
        // ---------- Notifications ----------
        function updateAlerts(calcu, goals) {
            const alertsCounter = document.getElementById("alertsCounter");
            const alertsDynamic = document.getElementById("alertsDynamic");

             if (!alertsDynamic || !alertsCounter) return;

            alertsDynamic.innerHTML = ""; // clear previous alerts
            let alerts = [];

            // Compute percent of goal used
            let percent = 0;
            if (goals.targetBill > 0) {
                percent = (calcu.totalCostMonth / goals.targetBill) * 100;
                percent = Math.min(percent, 100);
            }

            // Add alerts based on percent
            if (percent >= 100) {
                alerts.push({
                    date: new Date().toLocaleDateString(),
                    message: "<strong>Goal reached!</strong> You have exceeded your target bill.",
                    icon: "fas fa-exclamation-triangle",
                    color: "bg-danger"
            });
            } else if (percent >= 80) {
                alerts.push({
                    date: new Date().toLocaleDateString(),
                message: "<strong>Warning:</strong> You're almost at your target bill.",
                icon: "fas fa-exclamation-circle",
                color: "bg-warning"
                });
            }

            // Electricity rate info (always show latest rate)
            alerts.push({
                date: "10/1/2025",
                message: `Current Meralco rate is <strong>â‚±13.47 per kWh</strong> (effective November 2025).`,
                icon: "fas fa-bolt",
                color: "bg-info"
            });

            // Display alerts
            if (alerts.length === 0) {
                const noNotifItem = document.createElement("div");
                noNotifItem.className = "dropdown-item text-center small text-gray-500";
                noNotifItem.textContent = "No recent notifications";
                alertsDynamic.appendChild(noNotifItem);
                alertsCounter.style.display = "none";
            } else {
                alerts.forEach(alert => {
                    const item = document.createElement("a");
                    item.href = "#";
                    item.className = "dropdown-item d-flex align-items-center load-page";
                    item.setAttribute("data-page", "pages/activity_log.html");
                    item.innerHTML = `
                        <div class="mr-3">
                        <div class="icon-circle ${alert.color}">
                            <i class="${alert.icon} text-white"></i>
                        </div>
                    </div>
                    <div>
                        <div class="small text-gray-500">${alert.date}</div>
                        ${alert.message}
                    </div>
                    `;
                    item.addEventListener("click", (e) => {
                        e.preventDefault();
                        //e.stopPropagation();

                        const alertsToggle = document.getElementById("alertsDropdown");
                        try {
                            if (alertsToggle && bootstrap) {
                                const dropdown = bootstrap.Dropdown.getInstance(toggle) || new bootstrap.Dropdown(toggle);
                                dropdown.hide();
                            } else {
                                const dropdownMenu = toggle?.nextElementSibling;
                                if (dropdownMenu) dropdownMenu.classList.remove("show");
                            }
                        } catch (err) {
                        }

                        if (typeof loadPage === "function") {
                            loadPage("pages/activity_log.html");
                        } else {
                            window.location.href = "pages/activity_log.html";
                        }
                    });
                    
                    alertsDynamic.appendChild(item);
                });

                alertsCounter.style.display = "inline-block";
                alertsCounter.textContent = alerts.length;
            }
        }

        function initUserPage() {
            AppState.loadGoals();
            AppState.loadCalculator();
            const calcu = AppState.getCalculator();
            const goals = AppState.getGoals();
            if (!calcu || !goals) return;

            updateAlerts(calcu, goals);
        }

        let tipInterval;
let lastTipIndex = -1; // to remember the last displayed tip

function initTipBox() {
  const energyTips = [
    "ðŸ’¡ Turn off lights when not in use.",
    "âš¡ Unplug chargers when your device is full.",
    "ðŸŒž Use natural light during the day.",
    "â„ï¸ Keep refrigerator doors closed tightly.",
    "ðŸŒ¿ Use energy-efficient LED bulbs.",
    "ðŸ”¥ Cook with lids on to save energy.",
    "ðŸŒ¬ï¸ Clean your air conditioner filters regularly.",
    "ðŸ”Œ Turn off appliances completely instead of standby.",
    "ðŸ¡ Set air conditioning to 25Â°C for efficiency.",
    "ðŸ§º Wash full loads of laundry to save water and power.",
    "ðŸŒ± Plant shade trees to reduce cooling costs.",
    "â˜€ï¸ Dry clothes under the sun instead of using a dryer.",
    "ðŸ–¥ï¸ Turn off your computer monitor when away.",
    "ðŸ“º Reduce screen brightness to save energy.",
    "ðŸ³ Match the pot size to the burner on your stove.",
    "ðŸ•¯ï¸ Use candles for mood lighting occasionally.",
    "ðŸ“¦ Defrost your freezer regularly for better efficiency.",
    "ðŸš— Carpool or walk short distances to reduce fuel use.",
    "ðŸ“´ Set devices to power-saving mode when possible."
  ];

  const tipBox = document.getElementById("energyTipBox");
  if (!tipBox) return;

  function getRandomTipIndex() {
    let newIndex;
    do {
      newIndex = Math.floor(Math.random() * energyTips.length);
    } while (newIndex === lastTipIndex && energyTips.length > 1);
    lastTipIndex = newIndex;
    return newIndex;
  }

  function updateTip() {
    tipBox.classList.add("slide-up");
    setTimeout(() => {
      const randomTip = energyTips[getRandomTipIndex()];
      tipBox.textContent = randomTip;
      tipBox.classList.remove("slide-up");
      tipBox.classList.add("slide-down");
      setTimeout(() => tipBox.classList.remove("slide-down"), 400);
    }, 400);
  }

  updateTip();

  if (tipInterval) clearInterval(tipInterval);
  tipInterval = setInterval(updateTip, 10000); // change tip every 10s
}



        //initUserPage();
    </script>

    <script src="js/pages-loader.js"></script>

</body>

</html>